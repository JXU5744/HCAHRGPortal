<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
@*<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">*@
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.13/css/bootstrap-multiselect.css" rel="stylesheet" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css" rel="stylesheet" />

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.13/js/bootstrap-multiselect.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

<link href="https://cdn.datatables.net/1.10.15/css/dataTables.bootstrap.min.css" rel="stylesheet" />
<link href="https://cdn.datatables.net/responsive/2.1.1/css/responsive.bootstrap.min.css" rel="stylesheet" />

<script src="https://cdn.datatables.net/1.10.15/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.15/js/dataTables.bootstrap4.min.js"></script>
<script type="text/javascript" src="~/js/jquey3.2.1.min.js"></script>
<script type="text/javascript" src="~/js/moment.min.js"></script>

<meta name="viewport" content="width=device-width, initial-scale=1">

<div class="jumbotron-fluid" style="margin-left: 5%;margin-right: 5%;width: 90%;">
    @*<form class="form-inline" action="Search/Index">*@
        <div class="row">
            <div class="col-12">
                <h3 align="center">Search Tickets For Audit/Dispute</h3>
            </div>
        </div>
        <div class="panel panel-success">
            <div class="panel-body" style="margin-left: 5%; width: 95%;">
                <div class="row">
                    <div class="col-2">
                        <span id="errormsgforcategory" style="color:red"></span>
                        <span id="errormsgforsubcategory" style="color:red"></span>
                        <span id="errormsgforstatus" style="color:red"></span>
                    </div>
                    <div class="col-10">
                    </div>
                </div>
                <br />
                <div class="panel panel-success">
                    <div class="panel-body">
                        <div class="row">
                            <div class="col-1">
                            </div>
                            <div class="col-4">
                                <label style="padding-left:25px" class="text-success">Environment</label>
                                <label>&nbsp;&nbsp;</label>
                                <input type="radio" name="group2" checked="checked"
                                       value="PDF"
                                       tabindex="0"
                                       required class="radio-success" />
                                <label class="text-success">Production</label>
                                <label>&nbsp;</label>
                                <input type="radio" name="group2"
                                       value="XML"
                                       tabindex="0"
                                       required />
                                <label class="text-primary">Training</label>
                            </div>
                            <div class="col-2">
                            </div>
                            <div class="col-4">
                                <div class="cols" tabindex="-1">
                                    <label class="text-primary">Select Audit /Dispute</label>
                                    <label>&nbsp;&nbsp;</label>
                                    <input type="radio" name="group1" checked="checked"
                                           value="PDF"
                                           tabindex="0"
                                           required class="radio-success" />
                                    <label class="text-primary">Audit</label>&nbsp;
                                    <label>&nbsp;</label>
                                    <input type="radio" name="group1"
                                           value="XML"
                                           tabindex="0"
                                           required class="radio-success" />
                                    <label class="text-danger">Dispute</label>
                                </div>
                            </div>
                            <div class="col-1">
                            </div>
                        </div>
                    </div>
                </div>
                <br />
                <div class="row">
                    <div class="col-3">
                        <div tabindex="-1" aria-checked="false" style="text-align:left;">
                            <label for="format-pdf">Service Delivery Group: </label>
                            <select name="teams" id="CatgID" class="form-control" title="select"
                                    asp-items="@(new SelectList(@ViewBag.ListOfCategory, "CatgID", "CatgDescription"))">
                            </select>
                        </div>
                    </div>
                    <div class="col-6">
                        <div tabindex="-1" aria-checked="false" style="text-align:left;">
                            <label for="format-pdf">Sub Category: </label>
                            <select name="teams" id="SubCatID" class="form-control">
                                <option value="0">Select SubCategory</option>
                            </select>

                        </div>
                    </div>
                    <div class="col-3">
                        <div tabindex="-1" aria-checked="false" style="text-align:left;">
                            <label for="format-pdf">Assigned To: </label>
                            <input type="text" id="txtassignedto">
                        </div>
                    </div>
                  
                </div>
                <br />
                <div class="row">
                    <div class="col-4">
                        <div aria-checked="false">
                            <label>Start Date: </label>
                            <input class="form-control" id="startdate" type="text" data-provide="datepicker">
                        </div>
                    </div>
                    <div class="col-4">
                        <div aria-checked="false">
                            <label>To Date: </label>
                            <input class="form-control" id="enddate" type="text" data-provide="datepicker">
                        </div>
                    </div>
                    <div class="col-4">
                        <button id="btnsearch" type="button" class="btn btn-primary">
                            Search
                        </button>                       
                        <button asp-controller="Search" id="btncancel" asp-action="Index" class="btn btn-danger">
                            Clear
                        </button>
                    </div>
                </div>
            </div>
        </div>
    @*</form>*@
</div>
<div style="width:100%; margin:0 auto;">
    <table id="example" class="table table-striped table-bordered dt-responsive nowrap" width="100%" cellspacing="0">
        <thead>
            <tr>
                <th>Ticket Code</th>
                <th>Service Delivery Group</th>
                <th>Category</th>
                <th>SubCategory</th>
                <th>Assigned To 3-4 ID</th>
                @*<th>AssignedTo</th>*@
                <th>Closed Date</th>
                <th>Topic</th>
            </tr>
        </thead>
    </table>
</div>
<script>
    $(document).ready(function () {
        $("#example").DataTable({
            "processing": true, // for show progress bar
            "serverSide": true, // for process server side
            "filter": true, // this is for disable filter (search box)
            "orderMulti": false, // for disable multiple column at once
            "ajax": {
                "url": "/Search/Details",
                "type": "POST",
                "datatype": "json"
            },
            "columnDefs": [{
                "targets": [0],
                "visible": true,
                "searchable": true
            }],
            "columns": [
                {
                    "render": function (data, type, full, meta) { return '<a  href="https://www.google.com" target="_blank">' + full.TicketCode + '</a>'; }
                },
                { "data": "JobCdDescHomeCurr", "name": "JobCdDescHomeCurr", "autoWidth": true },
                { "data": "Category", "name": "Category", "autoWidth": true },
                { "data": "SubCategory", "name": "SubCategory", "autoWidth": true },
                { "data": "Employee34IdLowerCase", "name": "Employee34IdLowerCase", "autowidth": true },
                //{ "data": "EmployeeFullName", "name": "EmployeeFullName", "autowidth": true },
                { "data": "ClosedDateTime", "name": "ClosedDateTime", "autowidth": true },
                { "data": "Topic", "name": "Topic", "autowidth": true },
            ]
        });
    });
</script>

<div id="popupcontent" title="Mandate Fields" hidden="hidden" class="container">

    <div class="row">
        <div class="col-sm-2"> </div>
        <div class="col-sm-6">
            <span id="errormsg" style="color:red"></span>
        </div>
        <div class="col-sm-4"><button id="btncancelpopup" class="btn btn-danger">Cancel</button></div>
    </div>
</div>

@section Scripts
    {
    <!-- Script for the date range picker -->
    <script type="text/javascript" src="~/js/daterangepicker.js"></script>
    <link rel="stylesheet"
          type="text/css"
          href="~/css/daterangepicker.css" />
    <!-- Script for the date range picker -->
    <script type="text/javascript">
        $(document).ready(function () {
            var dateStart = new Date();
            dateStart.setDate(dateStart.getDate() - 30);
            $("#startdate").val($.datepicker.formatDate("dd-mm-yy", dateStart));

            var dateEnd = new Date();
            dateEnd.setDate(dateEnd.getDate() - 1);
            $("#enddate").val($.datepicker.formatDate("dd-mm-yy", dateEnd));

            $.ajax({
                type: "POST",
                url: "/search/GetCommaSeperated",
                data: null,
                success: function (response) {
                    $("#txtassignedto").autocomplete({
                        source: response
                    });
                },
                failure: function (response) {
                    alert(response.responseText);
                },
                error: function (response) {
                    alert(response.responseText);
                }
            });

            $("#popupcontent").dialog({
                autoOpen: false
            });

            $("#popupcontent").dialog({ autoOpen: false, modal: true, height: 190, width: 650 });

            $("#btncancel").click(function () {
                $("#popupcontent").dialog('close');
            });

            var dtable = $('#example').DataTable();

            $('.filter-button').on('click', function () {
                //clear global search values
                dtable.search('');
                $('.filter').each(function () {
                    if (this.value.length) {
                        dtable.column($(this).data('columnIndex')).search(this.value);
                    }
                });
                dtable.draw();
            });

            $("#btnsearch").click(function () {
                $("#errormsgforcategory").text("");
                $("#errormsgforsubcategory").text("");
                $("#errormsgforstatus").text("");
                var categoryID = $("#CatgID").val();
                var subcategoryID = $("#SubCatID").val();
                var statusid = $("#StatusList").val();

                if (categoryID == "0") {
                    $("#errormsgforcategory").append("Select Category<br/>");
                }
                if (subcategoryID == "0") {
                    $("#errormsgforsubcategory").append("Select SubCategory<br/>");
                }
                if (statusid == "0") {
                    $("#errormsgforstatus").append("Select Status<br/>");
                }
                if ($("#errormsgforcategory").text() != "" || $("#errormsgforsubcategory").text() != "" || $("#errormsgforstatus").text() != "") {
                    return false;
                }
            });

            if (data) {
                oTable = $('#example').DataTable();
                oTable.draw();
            } else {
                alert("Something Went Wrong!");
            }

            //$("#example").DataTable({
            //    "processing": true, // for show progress bar
            //    "serverSide": true, // for process server side
            //    "filter": true, // this is for disable filter (search box)
            //    "orderMulti": false, // for disable multiple column at once
            //    "ajax": {
            //        "url": "/Search/Details",
            //        "type": "POST",
            //        "datatype": "json"
            //    },
            //    "columnDefs": [{
            //        "targets": [0],
            //        "visible": true,
            //        "searchable": true
            //    }],
            //    "columns": [
            //        {
            //            "render": function (data, type, full, meta) { return '<a  href="https://www.google.com" target="_blank">' + full.TicketCode + '</a>'; }
            //        },
            //        { "data": "JobCdDescHomeCurr", "name": "JobCdDescHomeCurr", "autoWidth": true },
            //        { "data": "Category", "name": "Category", "autoWidth": true },
            //        { "data": "SubCategory", "name": "SubCategory", "autoWidth": true },
            //        { "data": "Employee34IdLowerCase", "name": "Employee34IdLowerCase", "autowidth": true },
            //        { "data": "EmployeeFullName", "name": "EmployeeFullName", "autowidth": true },
            //        { "data": "ClosedDateTime", "name": "ClosedDateTime", "autowidth": true },
            //        { "data": "Topic", "name": "Topic", "autowidth": true },
            //    ]
            //});

            $("#CatgID").change(function () {
                var categoryID = $('#CatgID').val();
                $.ajax({
                    type: "POST",
                    url: "/search/BindSubCategory",
                    data: { "categoryID": categoryID },
                    success: function (response) {
                        $('#SubCatID').html(''); $("#ShowQuestions").hide();
                        var options = '';
                        options += '<option value="0">Select SubCategory</option>';
                        for (var i = 0; i < response.length; i++) {
                            options += '<option value="' + response[i].SubCatgID + '">' + response[i].SubCatgDescription + '</option>';
                        }
                        $('#SubCatID').append(options);
                    },
                    failure: function (response) {
                        alert(response.responseText);
                    },
                    error: function (response) {
                        alert(response.responseText);
                    }
                });

            });

        });

    </script>
}

