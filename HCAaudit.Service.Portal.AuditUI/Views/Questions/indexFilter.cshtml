@{
    ViewData["Title"] = "Questions Page";
}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

<link href="https://cdn.datatables.net/1.10.15/css/dataTables.bootstrap.min.css" rel="stylesheet" />
<link href="https://cdn.datatables.net/responsive/2.1.1/css/responsive.bootstrap.min.css" rel="stylesheet" />

<script src="https://cdn.datatables.net/1.10.15/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.15/js/dataTables.bootstrap4.min.js"></script>

<script src="https://code.jquery.com/ui/1.11.1/jquery-ui.min.js"></script>
<link rel="stylesheet" href="https://code.jquery.com/ui/1.11.1/themes/smoothness/jquery-ui.css" />

@model HCAaudit.Service.Portal.AuditUI.Models.QuestionMaster

<div class="container">
    <br />
    <div class="row">
        <div class="col-sm-5">
            <label for="format-pdf" style="text-align:left;">Service Group / Department*</label>
            <select name="teams" id="CatgID" class="form-control" title="select"
                    asp-items="@(new SelectList(@ViewBag.ListOfCategory, "CatgID", "CatgDescription"))">
            </select>
        </div>
        <div class="col-sm-4">
            <label for="format-pdf" style="text-align:left;">Sub Category</label>
            <select name="teams" id="SubCatID" class="form-control">
            </select>
        </div>
        <div class="col-sm-1"></div>
        <div class="col-sm-2"><button type="button" id="btnopenPopUp" class="btn btn-primary">Add Question</button> </div>
    </div>

    <br />
    <div style="width:100%; margin:0 auto;">
        <table id="example" class="table table-striped table-bordered dt-responsive nowrap" width="100%" cellspacing="0">
            <thead>
                <tr>
                    <th>QuestionID</th>
                    <th>Question Name</th>
                    <th>Edit</th>
                    <th>Delete</th>
                </tr>
            </thead>
        </table>
    </div>
</div>

<div id="popupcontent" title="Map Question" hidden="hidden" class="container">

    <div class="card">
        <div class="col-sm-2"> <label class="input-group">Category:</label></div>
        <div class="col-sm-5">
            <input id="txtcategory" class="form-control form-control-sm"
                   type="text" disabled="disabled" />
        </div>
        <div class="col-sm-3">
            <button id="btnaddQuestion" class="btn btn-primary">
                Add Question
            </button>
        </div>
    </div>
    <div class="card">
        <div class="col-sm-2"> <label class="input-group">SubCategory:</label></div>
        <div class="col-sm-5">
            <input id="txtsubcategory" class="form-control form-control-sm"
                   type="text" disabled="disabled" />
        </div>
    </div>

    <div class="card">
        <div class="col-sm-2"> <label class="input-group">Question Text:</label></div>
        <div class="col-sm-5">
            <input id="txtquestion" class="form-control form-control-sm"
                   type="text" />
        </div>
    </div>

    <div class="card">
        <div class="col-sm-2"> <label class="input-group">Question Volumn:</label></div>
        <div class="col-sm-5">
            <input id="txtquestionvolumn" class="form-control form-control-sm"
                   type="text" disabled="disabled" />
        </div>
    </div>

</div>

<script>
    $(document).ready(function () {

        $("#example").DataTable({
            "processing": true, // for show progress bar
            "serverSide": true, // for process server side
            "filter": false, // this is for disable filter (search box)
            "orderMulti": false, // for disable multiple column at once
            "ajax": {
                "url": "/Questions/Details",
                "type": "POST",
                "datatype": "json"
            },
            "columnDefs": [{
                "targets": [0],
                "visible": false,
                "searchable": false
            }],
            "columns": [
                { "data": "QuestionID", "name": "QuestionID", "autoWidth": true },
                { "data": "QuestionName", "name": "QuestionName", "autoWidth": true },
                {
                    "render": function (data, type, full, meta) { return '<a class="btn btn-info" href="/Question/Edit/' + full.QuestionID + '">Edit</a>'; }
                },
                {
                    data: null,
                    render: function (data, type, row) {
                        return "<a href='#' class='btn btn-danger' onclick=DeleteData('" + row.QuestionID + "'); >Delete</a>";
                    }
                },
            ]

        });

        $(function () {
            $("#popupcontent").dialog({
                autoOpen: false
            });

            $("#btnopenPopUp").click(function () {
                var subCategoryID = $("#SubCatID option:selected").text();
                var categoryID = $("#CatgID option:selected").text();
                $('#txtcategory').val(categoryID);
                $('#txtsubcategory').val(subCategoryID);
                $("#popupcontent").dialog({
                    position: 'bottom'
                });

                $("#popupcontent").dialog('open');
            });
        });


        //$("#btnaddquestion").hide();
        $("#popupcontent").dialog({ autoOpen: false, modal: true, height: 590, width: 1005 });
        $("#btnaddquestion").click(function () {
            $("#popupcontent").dialog('open');
        });

        $("#btnsavequestion").click(function () {

            var subCategoryID = $('#SubCatID').val() + "^" + $('#txtquestion').val() + "^" + $("#txtquestionvolumn").val();
            $.ajax({
                type: "POST",
                url: "/Questions/SaveQuestion",
                data: { "subcatgid": subCategoryID },
                success: function (response) {
                    $("#popupcontent").dialog('close');
                },
                failure: function (response) {
                    alert(response.responseText);
                },
                error: function (response) {
                    alert(response.responseText);
                }
            });

        });
        //$("#ShowQuestions").hide();
        $("#CatgID").change(function () {
            var categoryID = $('#CatgID').val();
            $.ajax({
                type: "POST",
                url: "/Questions/BindSubCategory",
                data: { "categoryID": categoryID },
                success: function (response) {
                    $('#SubCatID').html(''); //$("#ShowQuestions").hide();
                    var options = '';
                    options += '<option value="Select">Select SubCategory</option>';
                    for (var i = 0; i < response.length; i++) {
                        options += '<option value="' + response[i].SubCatgID + '">' + response[i].SubCatgDescription + '</option>';
                    }
                    $('#SubCatID').append(options);
                },
                failure: function (response) {
                    alert(response.responseText);
                },
                error: function (response) {
                    alert(response.responseText);
                }
            });

        });


        $("#SubCatID").change(function () {
            var subCategoryID = $('#SubCatID').val();

            $.ajax({
                type: "Get",
                url: "/Questions/index",
                data: { "subCategoryID": subCategoryID }
                , success: function (response) {
                    //$("#ShowQuestions").show();
                    //$("#btnaddquestion").show();
                },
                failure: function (response) {
                    alert("Failure");
                },
                error: function (response) {
                    return true;
                }
            });

        });

    });
</script>
        }
